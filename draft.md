PORT=4000 node ./src/app.js
PORT=4000 NODE_ENV=development node ./src/app.js

const hostname = process.env.HOST || 'localhost';
const port = process.env.PORT;

"start:prod": "cross-env webpack --config webpack.config.js && node dist/build.js ",
# Задание: CRUD API

## Описание

Ваша задача - реализовать простой CRUD API с использованием встроенной базы данных в памяти.

## Технические требования

- Задание может быть выполнено на JavaScript или TypeScript
- Разрешены только `nodemon`, `dotenv`, `cross-env`, `typescript`, `ts-node`, `ts-node-dev`, `eslint` и его плагины, `webpack-cli`, `webpack` и его плагины, `prettier`, `uuid`, `@types/*`, а также используемые для тестирования библиотеки
- Используйте 18 LTS версию Node.js
- Предпочтительно использовать асинхронное API, где это возможно

## Детали реализации

1. Реализован конечный пункт `api/users`:
  - **GET** `api/users` используется для получения всех пользователей
    - Сервер должен ответить со статусом `200` и всеми записями пользователей
  - **GET** `api/users/{userId}`
    - Сервер должен ответить со статусом `200` и записью с `id === userId`, если она существует
    - Сервер должен ответить со статусом `400` и соответствующим сообщением, если `userId` недействительный (не является `uuid`)
    - Сервер должен ответить со статусом `404` и соответствующим сообщением, если запись с `id === userId` не существует
  - **POST** `api/users` используется для создания записи о новом пользователе и сохранения ее в базе данных
    - Сервер должен ответить со статусом `201` и вновь созданной записью
    - Сервер должен ответить со статусом `400` и соответствующим сообщением, если тело запроса не содержит **обязательных** полей
  - **PUT** `api/users/{userId}` используется для обновления существующего пользователя
    - Сервер должен ответить со статусом `200` и обновленной записью
    - Сервер должен ответить со статусом `400` и соответствующим сообщением, если `userId` недействительный (не является `uuid`)
    - Сервер должен ответить со статусом `404` и соответствующим сообщением, если запись с `id === userId` не существует
  - **DELETE** `api/users/{userId}` используется для удаления существующего пользователя из базы данных
    - Сервер должен ответить со статусом `204`, если запись найдена и удалена
    - Сервер должен ответить со статусом `400` и соответствующим сообщением, если `userId` недействительный (не является `uuid`)
    - Сервер должен ответить со статусом
2. Пользователи хранятся в виде `объектов` со следующими свойствами:
  - `id` — уникальный идентификатор (`строка`, `uuid`), сгенерированный на стороне сервера
  - `username` — имя пользователя (`строка`, **обязательное**)
  - `age` — возраст пользователя (`число`, **обязательное**)
  - `hobbies` — увлечения пользователя (`массив` строк или пустой `массив`, **обязательное**)

3. Запросы к несуществующим конечным точкам (например, `some-non/existing/resource`) должны быть обработаны (сервер должен ответить со `статус кодом` **404** и соответствующим понятным для пользователя сообщением).

4. Ошибки на стороне сервера, возникающие в процессе обработки запроса, должны быть обработаны и обработаны правильно (сервер должен ответить со `статус кодом` **500** и соответствующим понятным для пользователя сообщением).

5. Значение `порта`, на котором работает приложение, должно быть сохранено в файле `.env`.

6. Приложение должно иметь 2 режима работы (**разработка** и **продакшн**):
  - Приложение запускается в режиме разработки с использованием `nodemon` (есть скрипт `npm start:dev`).
  - Приложение запускается в режиме продакшн (есть скрипт `npm start:prod`, который запускает процесс сборки, а затем выполняет собранный файл).

7. Может быть несколько тестов для API (не менее **3** сценариев). Пример сценария тестирования:
  1. Получение всех записей с помощью запроса `GET` `api/users` (ожидается пустой массив).
  2. Создание нового объекта с помощью запроса `POST` `api/users` (ожидается ответ, содержащий вновь созданную запись).
  3. С помощью запроса `GET` `api/user/{userId}` мы пытаемся получить созданную запись по ее `id` (ожидается созданная запись).
  4. Мы пытаемся обновить созданную запись с помощью запроса `PUT` `api/users/{userId}` (ожидается ответ, содержащий обновленный объект с тем же `id`).
  5. С помощью запроса `DELETE` `api/users/{userId}` мы удаляем созданный объект по `id` (ожидается подтверждение успешного удаления).
  6. С помощью запроса `GET` `api/users/{userId}` мы пытаемся получить удаленный объект по `id` (ожидается ответ о т
8. Для приложения может быть реализовано горизонтальное масштабирование. Для этого должен быть настроен скрипт `npm start:multi`, который запускает несколько экземпляров приложения с использованием Node.js `Cluster` API (количество экземпляров равно числу доступных ядер минус 1 на хост-машине), каждый из которых слушает порт `PORT + n`. В приложении также присутствует **балансировщик нагрузки**, который распределяет запросы между экземплярами приложения (используя алгоритм Round-robin). Например, если доступно 4 ядра и `PORT` равен 4000, при запуске команды `npm run start:multi` происходит следующее:
- Балансировщик нагрузки слушает запросы на `localhost:4000/api`.
- Рабочие экземпляры (`workers`) слушают запросы от балансировщика нагрузки на `localhost:4001/api`, `localhost:4002/api`, `localhost:4003/api`.
- Когда пользователь отправляет запрос на `localhost:4000/api`, балансировщик нагрузки отправляет этот запрос на `localhost:4001/api`. Следующий запрос пользователя отправляется на `localhost:4002/api` и так далее.
- После отправки запроса на `localhost:4003/api` балансировщик нагрузки снова начинает с первого рабочего экземпляра (отправляет запрос на `localhost:4001/api`).
- Состояние базы данных должно быть согласованным между разными рабочими экземплярами. Например:
  1. Первый запрос `POST`, отправленный на `localhost:4001/api`, создает пользователя.
  2. Второй запрос `GET`, отправленный на `localhost:4002/api`, должен вернуть созданного пользователя.
  3. Третий запрос `DELETE`, отправленный на `localhost:4003/api`, удаляет созданного пользователя.
  4. Четвертый запрос `GET`, отправленный на `localhost:4001/api`, должен вернуть **404** статусный код для созданного пользователя.
